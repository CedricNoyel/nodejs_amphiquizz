<!DOCTYPE html> 
<html>
	<head>
		<meta charset="UTF-8">
		<title>AmphiQuizz - Admin</title>
		<link rel="stylesheet" type="text/css" href="../../css/question.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/commun.css"/>
		<script src="../../js/jquery.js"></script>
		<script src="../../js/jquery-ui.js"></script>	
		<script src="/socket.io/socket.io.js"></script>
		<script src="../../js/questionRapide.js"></script>
		<script src="../../js/commun.js"></script>
	</head>

	<body>
		<container>
			<div class="btnRetour">
				<button type="button" id="backButton">Retour</button>
			</div>
			<div class="nomQuestion">
				<div class="group">
					<input class="textField" name="nom" type="text" id="question" value="" required>
					<span class="highlight"></span>
					<span class="bar"></span>
					<label>Question</label>
				</div>
				<!-- <button class="bouton suppr" id="btnSupprimerQuestion" type="button">Supprimer</button> -->
				<button class="bouton" id="launchQuestionnaire" type="button">Lancer</button>
			</div>
			
			<div class="reponses">
				<div class="ajouterReponses">
					<div class="group">
						<input class="textField" name="nom" type="text" id="rep_A" value="" required>
						<span class="highlight"></span>
						<span class="bar"></span>
						<label>Réponse A</label>
					</div>
					
					<div class="group">
						<input class="textField" name="nom" type="text" id="rep_B" value="" required>
						<span class="highlight"></span>
						<span class="bar"></span>
						<label>Réponse B</label>
					</div>
					<div>
						<p>Bonne réponse :</p>
						<input type="radio" name="radioAnswer" value="A"> A<br>
  						<input type="radio" name="radioAnswer" value="B"> B<br>
					</div>
					<button class="bouton" id="oui_non" type="button">Oui / Non</button>
					<button id='saveQuestion' class="bouton save" type="button">Enregistrer</button>
				</div>
			</div>
		</container>

	<script>

$(document).ready(function(){

	var ID_QUESTION;

    var pos_id_quest = document.URL.lastIndexOf('/');
    var ID_QUESTION = document.URL.substr(pos_id_quest+1);
	
	$('#oui_non').click(function(){
		$("#rep_A").val("Oui");
		$("#rep_B").val("Non");
	});

	$('#saveQuestion').click(function(){
		saveQuestion();
	});

	$('#backButton').click(function(){
		document.location.href='../../admin';
	});

	$('#launchQuestionnaire').click(function(){
		if (saveQuestion()){
			socket.emit('req_id_questionnaire_by_id_question', ID_QUESTION);
			socket.on('res_id_questionnaire_by_id_question', function(idquestionnaire){
				socket.emit('req_launch_questionnaire', idquestionnaire);
				socket.on('res_launch_questionnaire', function(id_session){
					alert(id_session);
		    		document.location.href='../launched/' + id_session;
				});	
			});
		}

	});

	function saveQuestion(){
		if ( $('#question').val() ){
			if ( $('#rep_A').val() ){
				if ( $('#rep_B').val() ){
					if ( $("input[name='radioAnswer']:checked").val() )
					{
						var questionName = $('#question').val();
						var answer_A = $('#rep_A').val();
						var answer_B = $('#rep_B').val();
						var goodAnswer = $("input[name='radioAnswer']:checked").val(); // A or B

						socket.emit('req_addQuestionRapide', ID_QUESTION, questionName, answer_A, answer_B, goodAnswer);
						socket.on('res_addQuestionRapide', function(){ });
						notif("La question a été enregistrée", "#2ECC71");
						return true;
					}
					else notif("Veuillez choisir une bonne réponse", "#E74C3C");
				} else notif("Veuillez indiquer le champ \"Réponse B\"", "#E74C3C");
			} else notif("Veuillez indiquer le champ \"Réponse A\"", "#E74C3C");
		} else notif("Veuillez indiquer le champ \"Question\"", "#E74C3C");
	}
	return false;
});

    function notif(text, color) {
		$('.pop').remove();
		pop = $('<div/>').addClass('pop').text(text).css({color: '#FFF', backgroundColor: color });
		$('body').append(pop);
		setTimeout(function (argument) {
			$(pop).fadeOut('200');
		}, 2000);
	}

	</script>
	</body>
</html>